<!DOCTYPE html>
<html>
<head>
    <title>Обработка авторизации</title>
    <script>
      function parseHashParams() {
          const hash = window.location.hash.substring(1);
          const params = new URLSearchParams(hash);

          if (params.get('status') === 'ok') {
              const authData = {
                  access_token: params.get('access_token'),
                  nickname: params.get('nickname'),
                  account_id: params.get('account_id'),
                  expires_at: params.get('expires_at')
              };

              localStorage.setItem('lesta_auth', JSON.stringify(authData));
              window.opener.postMessage({ type: 'lesta_auth_success', data: authData }, '*');
              window.close();
          } else {
              window.opener.postMessage({ type: 'lesta_auth_failed' }, '*');
              window.close();
          }
      }

      window.addEventListener('DOMContentLoaded', parseHashParams);
  </script>
</head>
<body>
    <p>Пожалуйста, подождите, идёт обработка авторизации...</p>
</body>
</html>
